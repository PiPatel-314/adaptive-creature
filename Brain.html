<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Simple Counter</title>
<style>
  body{font-family:Arial, sans-serif;display:flex;height:100vh;background:#f0f0f0;padding:20px;gap:20px;box-sizing:border-box}
  .card{background:#fff;padding:24px;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.08);width:320px}
  h1{font-size:1.6rem;margin:0 0 12px}
  h2{margin:6px 0}
  button{display:inline-block;padding:10px 14px;border-radius:6px;border:none;background:#007BFF;color:#fff;cursor:pointer;margin:6px 0}
  button:disabled{opacity:.5;cursor:not-allowed}
  .will{display:none} /* hidden until unlocked */
  ul{padding-left:18px;margin:8px 0}
  .small{font-size:.9rem}
.first {
  display: grid;
  grid-template-columns: 320px 1fr; /* left fixed column matches .card width */
  gap: 20px;
  align-items: start;
  width: auto;
  box-sizing: border-box;
}
.prestige{display:none}
#brain-div { display: none; }
#unblood-value { display: none; }
#explore-div { display: none; }
#ability-div { display: none; }
#blood-total {display: none; }
#combat-div {display: none; }
#evolve {display: none;}
#blood-display {
 position: sticky;
  top: 20px;
  z-index: 100;
  width: auto;       /* fills the left grid column */
  box-sizing: border-box;
}
#run {width: auto;
  box-sizing: border-box;}
#explore-div,
#spray-div {
  display: none;
}


.tabs { display:flex; gap:8px; margin-bottom:12px; }
.tab-btn { padding:8px 12px; border-radius:6px; border:1px solid #ddd; background:#fff; cursor:pointer; }
.tab-btn.active { background:#007BFF; color:#fff; border-color:#007BFF; }
.tab-panel { display:block; } /* we toggle via inline style or JS */
</style>
</head>
<body>
<div class="tabs">
  <button class="tab-btn active" data-tab="main">Main</button>
  <button class="tab-btn" data-tab="abilities">Abilities</button>
  <button class="tab-btn" data-tab="combat">Combat</button>
  <button class="tab-btn" data-tab="story">Story</button>
  <button class="tab-btn" data-tab="body">Body</button>
</div>

<!-- Main Panel -->
<div id="panel-main" class="tab-panel" style="display:block">
	<button id="evolve">Evolve</button>

  <div class="first">
    <div class="card" id="blood-display">
      <h1>????</h1>
      <h2 id="blood-value">Blood: 0.00</h2>
      <h2 id="unblood-value">Unoxygenated Blood: 0.00</h2>
      <h2 id="blood-total">Blood total: 0</h2>
      <h2 id="will-value">Will: 0.00</h2>
      <div id="counter-value"></div>
      <button id="increment-btn">Stop bleeding (gain Will)</button>
      <button id="purchase-btn">Revive / Start</button>
    </div>

    <div class="card" id="run">
      <button id="will-blood" class="will">Restores blood: 1 Will</button>
      <button id="hope-mult" class="will">Doubles this runâ€™s hope gain: 5 Will</button>
      <button id="blood-produce" class="will">Produce blood: 10 Will</button>
      <div style="margin-top:12px">
        <ul>
          <li><h2 id="hope-value" class="small">Hope: 0.00</h2></li>
          <li><button id="will-gain" class="small">Increase will gain: 0.10 Hope</button></li>
          <li><button id="blood-gain" class="small">Increase starting blood: 1 Hope</button></li>
          <li><button id="will-upgrade" class="small">Discover will upgrades: 5 Hope</button></li>
          <li><button id="blood-drain" class="small">Reduce blood drain: 10 Hope</button></li>
          <li><button id="btn-blood-gain" class="small">Increase blood gain: 20 Hope</button></li>
          <li><input type="text" id="dev-mode"></li>
        </ul>
      </div>

      <div class="card prestige first" id="prestige-div">
        <button id="evolve">Evolve</button>
        <div id="prestigeTwo">
          <h2 id="mutagen-label">Mutagen: 0</h2>
          <button id="brain-unlock">Unlock the mind</button>
        </div>

        <div id="brain-div">
          <h2 id="thought-label">Thoughts: 0</h2>
          <input type="checkbox" id="think-btn">Think</input>
	<button id="thought-blood-product">Increase blood production: 2 Thoughts</button>
          <button id="explore-Btn">Unlock exploration: 5 Thoughts</button>
          <button id="see-blood">Unlock blood type: 10 Thoughts</button>
		<button id="acid-unlock">Unlock combat ability: 5 Thoughts</button>
		<button id="thought-ability-unlock">Unlock thought ability: 20 Thoughts</button>
<button id="thought-product">Increase thought production: 5 Thoughts</button>
<button id="evolution-unlock">Unlock evolution: 100 Thoughts</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Abilities Panel -->
<div id="panel-abilities" class="tab-panel">
 </div>

<!-- Combat Panel -->
<div id="panel-combat" class="tab-panel">
 <div class="card" id="ability-div">
    <div id="explore-div">
	<h3>Explore</h3>
       <input id="explore-auto" type="range" min="0.0" max="5.0" value="0.0" class="slider"></input>
      <h3 id="explore-count">Blood automation: 0/second</h3>
      <h3 id="explore-value">0/1</h3>
    </div>

    <div id="spray-div">
      <h3>Acid spray</h3>
      <input id="spray-auto" type="range" min="0" max="10" value="0" class="slider"></input>
      <h3 id="spray-count">Blood automation: 0/second</h3>
      <h3 id="spray-value">0/2</h3>
    </div>
    <div id="crit-div">
	<h3>Find weak points</h3>
	<input id="crit-auto" type="range" min="0" max="10" value="0" class="slider"></input>
	<h3 id="crit-count">Blood automation: 0/second</h3>
	<h3 id="crit-value">0/3</h3>
  </div>

  <div id="combat-panel" class="card">
    <h3 id="monster-name">Rat</h3>
    <h3 id="monster-health">5/5</h3>
    <h3 id="monster-attack">0/3</h3>
  </div>
</div>
</div>
<!-- Story Panel -->
<div id="panel-story" class="tab-panel">
  <div class="card">
    <p id="story-text">You're bleeding out</p>
  </div>
</div>
<div id="panel-body" class="tab-panel">
<div class="card">
<p>Heart: regular stats</p>
<p>Large heart:Blood capacity X 2 blood production X 0.5</p>
</div>
</div>
<script>
/* --- Elements --- */
const firstScreen = document.getElementsByClassName('first')

const unBloodValue = document.getElementById('unblood-value')
const bloodValue = document.getElementById('blood-value');
const willText = document.getElementById('will-value');
const hopeValue = document.getElementById('hope-value');
const storyText = document.getElementById('story-text');

const incrementButton = document.getElementById('increment-btn');
const purchaseButton = document.getElementById('purchase-btn');

const willBlood = document.getElementById('will-blood');
const willGain = document.getElementById('will-gain');
const bloodGain = document.getElementById('blood-gain');
const willUpgrade = document.getElementById('will-upgrade');
const hopeMult = document.getElementById('hope-mult');
const bloodDrain = document.getElementById('blood-drain');
const btnGainBlood = document.getElementById('btn-blood-gain');
const bloodproduce = document.getElementById('blood-produce')

const prestigeDiv = document.getElementById('prestige-div')
const evolveBtn = document.getElementById('evolve')
const prestigeGrade = document.getElementById('prestigeTwo')

const mutagenLabel = document.getElementById('mutagen-label')
const brainBtn = document.getElementById('brain-unlock')

const brainDiv = document.getElementById('brain-div')
const thinkBtn = document.getElementById('think-btn')
const thoughtLabel = document.getElementById('thought-label')
const exploreUnlock = document.getElementById('explore-Btn')
const bloodUnlock = document.getElementById('see-blood')
const thoughtBloodProduct = document.getElementById('thought-blood-product')
const bloodTotalLabel = document.getElementById('blood-total')

const exploreDiv = document.getElementById('explore-div')
const abilityDiv = document.getElementById('ability-div')
const exploreBtn = document.getElementById('explore-btn')
const exploreAuto = document.getElementById('explore-auto')
const sprayAuto = document.getElementById('spray-auto')
const exploreValue = document.getElementById('explore-value')
const sprayValue = document.getElementById('spray-value')
const sprayCount = document.getElementById('spray-count')
const sprayDiv = document.getElementById('spray-div')
const exploreCount = document.getElementById('explore-count')
const critCount = document.getElementById('crit-count')
const critValue = document.getElementById('crit-value')
const critDiv = document.getElementById('crit-div')

const combatDiv = document.getElementById('combat-panel')
const monsterName = document.getElementById('monster-name')
const monsterAttack = document.getElementById('monster-attack')
const monsterHealthLabel = document.getElementById('monster-health')

const acidUnlock = document.getElementById('acid-unlock')
const thoughtAbilityUnlock = document.getElementById('thought-ability-unlock')
const thoughtProduct = document.getElementById('thought-product')
const evolutionUnlock = document.getElementById('evolution-unlock')

const devMode = document.getElementById('dev-mode');


/* --- Game state --- */
let remainingTime = 0;        // authoritative timer (seconds)
let tickMs = 100;             // tick every 100ms
let decayPerTick = tickMs/1000; // seconds lost per tick
let prestigeCheck = 0
let timeBefore = 0

let Startblood = 10;          // base starting blood for a run
let bloodBonus = 0;           // added by heals during run (persistent for run)
let bloodGainMult = 1;
let will = 0;                 // displayed will you spend/use
let trueWill = 0;             // will accumulated for converting to hope on death
let hope = 0;                 // currency between runs

let unBlood = 0

let willMultiply = 1;         // will gain multiplier
let timerInterval = null;
let dead = true;              // start as not running until start/revive
let diedOnce = false;
let hopeOnce = false;

/* --- Upgrade costs/scale --- */
let willGainCost = 0.1;       // cost in hope for next will-gain upgrade
let willGainScale = 2;       // multiplicative scale after purchase

let bloodGainCost = 1;        // cost in hope for starting blood upgrade
let bloodGainScale = 3;     // scale multiplier after purchase

let willBloodCost = 1;        // will cost to use willBlood heal
let willBloodScale = 0.1;     // increase to willBloodCost after each use

let bloodDrainCost = 10;
let bloodDrainScale = 1.5

let bloodMultCost = 20
let bloodMultScale = 1.75

let willGainLevel = 0
let bloodGainLevel = 0
let bloodDrainLevel = 0
let bloodMultLevel = 0
let startingBloodLevel = 0
let willBloodLevel = 0
let bloodProductLevel = 0
let thoughtBloodProductLevel = 0
let thoughtBloodMult = 1

let hopeMultiplier = 1
let timeMult = 1

let bloodProduct = 0
let bloodProductScale = 1.3
let bloodProductCost = 10
let willShow = false
let prestigeTriggered = false
let evolved = false

let mutagen = 0
let thinkLoss = 0
let thinking = false
let thought = 0
let bloodTotal = 0
let bloodLabelChange = false
let randomNumber = 0
let abilityTriggerable = false
let cooldownTime = 0

let exploreAutomated = false
let sprayTime = 0
let abilityCooldown = 0
let combatEngaged = false
let activeEnemy = 0
let combatShown = false
/* -----------Abilities----------*/
const abilities = [
  {
    id: "acidSpray",
    name: "Acid Spray",
    cost: 5,              // total blood required to charge
    cooldown: 1,          // seconds of cooldown after firing
    sliderId: "spray-auto", // id of the linked range input
    sliderElem: null,     // assigned later
    progress: 0,          // how much blood invested so far
    progressDisplay: sprayValue,
    autoDisplay: sprayCount,
    abilityDiv: sprayDiv,
    cooldownTimer: 0,
    cooldownAsk: false,
    active: false,
	unlocked: false,
    effect: () => {
if (combatEngaged == true) {
damageEnemy(activeEnemy,1)
}
    }
  },
  {
    id: "exploration",
    name: "Exploration",
    cost: 2,
    cooldown: 2,
    sliderId: "explore-auto",
    sliderElem: null,
    progress: 0,
	progressDisplay: exploreValue,
	autoDisplay: exploreCount,
	abilityDiv: exploreDiv,
    cooldownTimer: 0,
    active: false,
	unlocked: false,
    effect: () => {
      randomNumber = Math.random() * 100
      if (randomNumber <= 50) {
battleStart()
};
    }
  },
{
id: "critical",
name: "Exploration",
cost: 3,
cooldown: 1,
sliderId: "crit-auto",
sliderElem: null,
progress: 0,
progressDisplay: critValue,
autoDisplay: critCount,
abilityDiv: critDiv,
cooldownTimer: 0,
active: false,
unlocked: false,
effect: () => {

},
}
];

const panelIds = {
  main: 'panel-main',
  abilities: 'panel-abilities',
  combat: 'panel-combat',
  story: 'panel-story',
  body: 'panel-body'
};


/*-----------Monsters------------*/
//Note to self this is a terrible idea
const monsterArr = [{
id: "rat",
name: "Rat",
maxHealth: 5,
health: 5,
cooldown: 2,
cooldownAsk: false,
progress: 0,
cooldownTimer: 0,
rate: 0.5,
cost: 3,
attack: 2,
healthDisplay: monsterHealthLabel,
attackDisplay: monsterAttack,
nameDisplay: monsterName,
reward: 1,
}]


/* ---------- Utility ---------- */
function resetGame() {
  localStorage.removeItem('gameSave');
  location.reload();
}
function loadGame() {
  const saved = JSON.parse(localStorage.getItem('gameSave'));
  if (!saved) return;

  hope = saved.hope ?? hope;
  Startblood = saved.Startblood ?? Startblood;
  bloodGainMult = saved.bloodGainMult ?? bloodGainMult;
  willMultiply = saved.willMultiply ?? willMultiply;
  willShow = saved.willShow ?? willShow;
  willGainLevel = saved.willGainLevel ?? willGainLevel;
  bloodGainLevel = saved.bloodGainLevel ?? bloodGainLevel;
  bloodDrainLevel = saved.bloodDrainLevel ?? bloodDrainLevel;
  bloodMultLevel = saved.bloodMultLevel ?? bloodMultLevel;
  startingBloodLevel = saved.startingBloodLevel ?? startingBloodLevel;
  willBloodLevel = saved.willBloodLevel ?? willBloodLevel;
  bloodProductLevel = saved.bloodProductLevel ?? bloodProductLevel;
  mutagen = saved.mutagen ?? mutagen;
}
function updateDisplays(){
	if (bloodLabelChange == false){
  bloodValue.textContent = (remainingTime > 0 && !dead) ? `Blood: ${remainingTime.toFixed(2)}` : dead ? "Blood: (dead)" : `Blood: ${remainingTime.toFixed(2)}`;
} else {
bloodValue.textContent = (remainingTime > 0 && !dead) ? `Oxygenated Blood: ${remainingTime.toFixed(2)}` : dead ? "Oxygenated Blood: (dead)" : `Oxygenated Blood: ${remainingTime.toFixed(2)}`
}
  willText.textContent = `Will: ${will.toFixed(2)}`;
  hopeValue.textContent = `Hope: ${hope.toFixed(2)}`;
  willBlood.textContent = `Restores blood: ${willCreepedLabel()} Will`
	thoughtLabel.textContent = `Thoughts: ${thought.toFixed(2)}`
	unBloodValue.textContent = `Unoxygenated Blood: ${unBlood.toFixed(2)}`
	bloodTotalLabel.textContent = `Blood total: ${bloodTotal}` 
saveGame()
}

function saveGame() {
  const saveData = {
    hope,
    Startblood,
    bloodGainMult,
    willMultiply,
    willShow,
    willGainLevel,
    bloodGainLevel,
    bloodDrainLevel,
    bloodMultLevel,
    startingBloodLevel,
    willBloodLevel,
    bloodProductLevel,
	mutagen
  };

  localStorage.setItem('gameSave', JSON.stringify(saveData));
}

/* ---------- Timer / run control ---------- */
function startRun(){
  // initialize run values
  dead = false;
  remainingTime = Startblood + 0; // fresh start; bloodBonus starts at 0
  bloodBonus = 0;
  will = 0;
  trueWill = 0;
  bloodTotal = Startblood
  storyText.textContent = "You're bleeding out";
  clearInterval(timerInterval);
  timerInterval = setInterval(updateTimer, tickMs);
  updateDisplays();
}

function updateTimer(){
  if (dead) return;
  // decrement authoritative remainingTime
	timeBefore = remainingTime
  remainingTime = remainingTime - (decayPerTick * timeMult) + (bloodProduct * thoughtBloodMult);

if (thinking) {
remainingTime -= thinkLoss * (tickMs/1000);
thought = parseFloat((thought + 0.5 * (tickMs/1000)).toFixed(2));
thoughtLabel.textContent = `Thoughts: ${thought.toFixed(2)}`
}
unBlood += (decayPerTick * timeMult) - (thoughtBloodMult * bloodProduct) + thinkLoss * (tickMs/1000)
bloodTotal = Math.round(remainingTime + unBlood, 0)


abilityTrigger()
if (combatEngaged == true) {
monsterAbility()
}

  // clamp so it doesn't go wildly negative for display purposes
  if (remainingTime <= 0) {
    remainingTime = 0;
    handleDeath();
  } else if (remainingTime > Startblood && evolved == false) {
	evolved = true
	prestigeTrigger()	
} 

if (remainingTime > bloodTotal) {
remainingTime = bloodTotal
unBlood = 0
}
updateDisplays()
}

function handleDeath(){
  if (dead) return;
  dead = true;
  clearInterval(timerInterval);
  // award hope equal to trueWill (what you actually generated during run)
  hope = parseFloat(((hope + trueWill) * hopeMultiplier).toFixed(2));
  storyText.textContent = diedOnce ? "You are getting better... You're still dying but improving." : "You died but that's okay this time you can try again. You're second chance gives you HOPE.";
  diedOnce = true;
  hopeOnce = true;
  // reset run-specific values
  hopeMultiplier = 1
  will = 0;
  trueWill = 0;
  unBlood = 0
  willBloodCost = 1
if (willShow == true) {
  hopeMult.style.display = "inline-block"
saveGame()
}
	bloodProductCost = 10
bloodproduce.textContent = `Produce blood: ${bloodProductCost} Will`
combatEngaged = false
combatDiv.style.display = 'none'
  updateDisplays();
  
}

function prestigeTrigger() {
if (prestigeTriggered) return;
  prestigeTriggered = true
storyText.textContent = 'The bleeding stops but you are still weak you must.'
for (let i = 0; i < firstScreen.length; i++) {
    firstScreen[i].style.display = 'none';
}
evolveBtn.style.display = 'inline-block'
prestigeDiv.style.display = 'inline-block'
prestigeGrade.style.display = 'none'
brainDiv.style.display = 'none'
}

function abilityTrigger() {
  if (dead) return;

  for (const ability of abilities) {
    // Ensure slider exists
    if (!ability.sliderElem) continue;
    const rate = parseFloat(ability.sliderElem.value) || 0;

    // If ability is on cooldown -> decrement timer and update display, then skip charging
    if (ability.cooldownTimer > 0) {
      ability.cooldownTimer -= tickMs / 1000;
      if (ability.cooldownTimer <= 0) {
        ability.cooldownTimer = 0;
        ability.cooldownAsk = false;
      } else {
        ability.cooldownAsk = true;
        ability.progressDisplay.textContent = `${ability.name} cooldown: ${ability.cooldownTimer.toFixed(1)}s`;
      }
      if (ability.progressDisplay) {
        ability.progressDisplay.textContent = `Cooldown: ${ability.cooldownTimer.toFixed(1)}s`;
        if (ability.autoDisplay) ability.autoDisplay.textContent = `Blood automation: ${rate.toFixed(2)}/s`;
      }
      continue; // don't charge while cooling down
    }

    // If slider is zero/inactive, show current progress but do not drain
    if (rate <= 0) {
      ability.active = false;
      if (ability.progressDisplay) {
        ability.progressDisplay.textContent = `${ability.progress.toFixed(2)}/${ability.cost.toFixed(2)}`;
        if (ability.autoDisplay) ability.autoDisplay.textContent = `Blood automation: ${rate.toFixed(2)}/s`;
      }
      continue;
    }

    // Active and not on cooldown: drain blood and charge ability
    ability.active = true;
    const drain = rate * (tickMs / 1000);
	const oxygenDrain = Math.min(remainingTime, drain);
    if (oxygenDrain > 0) {
      remainingTime -= oxygenDrain;
	unBlood += oxygenDrain;
      ability.progress += oxygenDrain;
    }

    // Fired
    if (ability.progress >= ability.cost) {
      ability.effect();
      ability.progress = 0;
      ability.cooldownTimer = ability.cooldown;
      if (ability.progressDisplay) ability.progressDisplay.textContent = `Cooldown: ${ability.cooldownTimer.toFixed(1)}s`;
    } else {
      if (ability.progressDisplay) ability.progressDisplay.textContent = `${ability.progress.toFixed(2)}/${ability.cost.toFixed(02)}`;
    }

    if (ability.autoDisplay) ability.autoDisplay.textContent = `Blood automation: ${rate.toFixed(2)}/s`;
  }

 if (combatShown) updateCombatUI()
}

function monsterAbility() {
if (!combatEngaged) return;
const dt = tickMs / 1000;

  monsterArr.forEach(monster => {
    const drain = monster.rate * dt;
	if (monster.cooldownTimer > 0) {
      monster.cooldownTimer -= dt;
      if (monster.cooldownTimer <= 0) {
        monster.cooldownTimer = 0;
	monster.cooldownAsk = false
      }
else {
monster.cooldownAsk = true 
};
if (monster.attackDisplay) {
if (monster.cooldownAsk == true) { 
monster.attackDisplay.textContent = `Cooldown: ${monster.cooldownTimer.toFixed(02)} seconds left`
}
else {
monster.attackDisplay.textContent = `${monster.progress.toFixed(1)}/${monster.cost.toFixed(02)}`
}
}
return
}


    monster.progress += drain;

    if (monster.progress >= monster.cost) {
      monster.progress = 0;
      remainingTime -= monster.attack;
      bloodTotal -= monster.attack;
	monster.cooldownTimer = monster.cooldown
	monster.cooldownAsk = true
if (monster.attackDisplay) monster.attackDisplay.textContent = `Cooldown: ${monster.cooldownTimer.toFixed(1)}s`;
      return;
    }

    // Update progress display while charging
    if (monster.attackDisplay) {
      monster.attackDisplay.textContent = `${monster.progress.toFixed(2)}/${monster.cost.toFixed(02)}`;
    
    }
	 if (combatShown) updateCombatUI()
  });
}

function damageEnemy(monsterNumber,playerDamage) {
let monsterObject = monsterArr[monsterNumber]
monsterObject.health -= playerDamage
monsterObject.healthDisplay.textContent = `${monsterObject.name}: ${monsterObject.health}/${monsterObject.maxHealth}`
if (monsterObject.health <= 0) {
   playerWin(monsterObject)
}
}
function playerWin(monsterObject) {
storyText.textContent = `The ${monsterObject.name} crumples to the floor. You get ${monsterObject.reward} corpse YAAAAY.`
combatEngaged = false
combatDiv.style.display = 'none'
}

function battleStart() {
monsterSelect()
let monsterObject = monsterArr[activeEnemy]
storyText.textContent = `a ${monsterObject.name} aproaches`
combatEngaged = true
combatDiv.style.display = 'inline-block'
}

function monsterSelect() {
activeEnemy = 0
}

function updateCombatUI() {
  monsterArr.forEach(monster => {
    if (monster.nameDisplay) monster.nameDisplay.textContent = monster.name;
    if (monster.healthDisplay) monster.healthDisplay.textContent = `${monster.health}/${monster.maxHealth}`;
    if (monster.attackDisplay) {
      if (monster.cooldownTimer > 0) monster.attackDisplay.textContent = `Cooldown: ${monster.cooldownTimer.toFixed(1)}s`;
      else monster.attackDisplay.textContent = `${monster.progress.toFixed(2)}/${monster.cost.toFixed(02)}`;
    }
  });
}


/* -----------Dev mode-----------*/

devMode.addEventListener('input', () => {
hope = parseFloat(devMode.value) || 0
updateDisplays()
})


evolveBtn.addEventListener('click', () => {
clearInterval(timerInterval);
for (let i = 0; i < firstScreen.length; i++) {
firstScreen[i].style.display = 'inline-block'
}
prestigeGrade.style.display = 'inline-block'
evolveBtn.style.display = 'none'
 willBlood.style.display = 'none';
	hopeMult.style.display = 'none'
	bloodproduce.style.display = 'none'
 Startblood = 10;          // base starting blood for a run
 bloodBonus = 0;           // added by heals during run (persistent for run)
 bloodGainMult = 1;
 will = 0;                 // displayed will you spend/use
 trueWill = 0;             // will accumulated for converting to hope on death
willGainCost = 0.1;       // cost in hope for next will-gain upgrade willGainScale = 2;       // multiplicative scale after purchase

bloodGainCost = 1;        // cost in hope for starting blood upgrade
bloodGainScale = 3;     // scale multiplier after purchase

 willBloodCost = 1;        // will cost to use willBlood heal
 willBloodScale = 0.1;     // increase to willBloodCost after each use

 bloodDrainCost = 10;
 bloodDrainScale = 1.5

 bloodMultCost = 20
 bloodMultScale = 1.75

 willGainLevel = 0
 bloodGainLevel = 0
 bloodDrainLevel = 0
 bloodMultLevel = 0
 startingBloodLevel = 0
 willBloodLevel = 0
 bloodProductLevel = 0
 willMultiply = 1

 hopeMultiplier = 1
 timeMult = 1

 bloodProduct = 0
 bloodProductScale = 1.3
 bloodProductCost = 10
 willShow = false
 unBlood = 0

prestigeTriggered = false
mutagen += 1

mutagenLabel.textContent  = `Mutagen: ${mutagen}`

bloodGain.textContent = `Increase starting blood: ${bloodGainCost.toFixed(2)} Hope`
btnGainBlood.textContent = `Increase blood gain: ${bloodMultCost.toFixed(2)} Hope`

	bloodDrain.textContent = `Reduce blood drain: ${bloodDrainCost.toFixed(2)} Hope`

willGain.textContent = `Increase will gain: ${willGainCost.toFixed(2)} Hope`

bloodGain.textContent = `Increase starting blood: ${bloodGainCost.toFixed(2)} Hope`

willUpgrade.style.display = 'inline-block'
saveGame()
startRun()
})
thoughtBloodProduct.addEventListener('click',() => {
if (thoughtBloodProductLevel < 1 && thought >= 2) {
thought -= 2
thoughtBloodProductLevel += 1
thoughtBloodMult += 1
thoughtBloodProduct.textContent = 'Maxed'
}
})




bloodUnlock.addEventListener('click',() => {
if (thought >= 10) {
thought -= 10
unBloodValue.style.display = 'inline-block'
bloodTotalLabel.style.display = 'inline-block'
bloodLabelChange = true
bloodUnlock.style.display = 'none'
}
})
exploreUnlock.addEventListener('click',() => {
if (thought >= 5) {
thought -= 5
exploreDiv.style.display = 'inline-block'
storyText.textContent = "You blindly trudge throught and endless void."
abilityTriggerable = true
exploreUnlock.style.display = 'none'
abilityDiv.style.display = 'inline-block'
abilities[1].unlocked = true
updateDisplays()
}
})
thinkBtn.addEventListener('click',() => {
if (thinking == false) {
thinking = true
thinkLoss = 1
} else {
thinking = false
thinkLoss = 0
}
})

bloodproduce.addEventListener('click', () => {
if (!dead && will >= bloodProductCost && bloodProductLevel == 0) {
	will = will - bloodProductCost
	bloodProductCost = bloodProductCost * bloodProductScale
	bloodProduct = bloodProduct + 0.1
bloodProductLevel += 1
	updateDisplays()
if (bloodProductLevel == 1) {
bloodproduce.textContent = 'Maxed'
} else {
bloodproduce.textContent = `Produce blood: ${bloodProductCost.toFixed(2)} Will`
}
}
})


btnGainBlood.addEventListener('click', () => {
	if (dead && hope >= bloodMultCost && bloodGainLevel < 5) {
		bloodGainLevel += 1
		hope = hope - bloodMultCost
		bloodGainMult = bloodGainMult + 1
		bloodMultCost = bloodMultCost * bloodMultScale
		if (bloodGainLevel == 5) {
		btnGainBlood.textContent = 'Maxed'
} else {
		btnGainBlood.textContent = `Increase blood gain: ${bloodMultCost.toFixed(2)} Hope`
}
	updateDisplays()

}
		

})

bloodDrain.addEventListener('click', () => {
 if (dead && hope >= bloodDrainCost && bloodDrainLevel < 9) {
	bloodDrainLevel += 1
	hope = hope - bloodDrainCost
	bloodDrainCost = bloodDrainCost * bloodDrainScale
	timeMult = timeMult - 0.1
	if (bloodDrainLevel == 9) {
	bloodDrain.textContent = 'Maxed'
} else {
	bloodDrain.textContent = `Reduce blood drain: ${bloodDrainCost.toFixed(2)} Hope`
}
		updateDisplays()
}
})
hopeMult.addEventListener('click', () => {
if (!dead && will >= 5) {
hopeMultiplier += 1
will = will - 5
hopeMult.style.display = 'none'}
})
// Gain will while alive
incrementButton.addEventListener('click', () => {
  if (dead) return;
  const gain = 0.01 * willMultiply;
  will += gain;
  trueWill += gain;
  updateDisplays();
});

// Revive / Start
purchaseButton.addEventListener('click', () => {
  if (dead) {
    startRun();
  }
});

// "Restore blood" - spend will in-run to add seconds
willBlood.addEventListener('click', () => {
  if (dead) return;
  if (will >= willBloodCost && willBloodLevel < 10){
    will -= willBloodCost;
    // scale cost for next use
    willBloodCost = parseFloat((willBloodCost + willBloodScale).toFixed(02));
    // Add persistent seconds directly to remainingTime (this works because remainingTime is authoritative)
    remainingTime += (1 * bloodGainMult);
	unBlood -= (1 * bloodGainMult)
    // update button text to reflect new cost
willBloodLevel += 1
if (willBloodLevel == 10) {
	willBlood.textContent = 'Maxed'
} else {
    willBlood.textContent = `Restores blood: ${willCreepedLabel()} Will`;
}
    updateDisplays();
  }
});

// helper label for willBlood button
function willCreepedLabel(){
  return willBloodCost.toFixed(02);
}
/* ---------- Upgrades ---------- */

thoughtAbilityUnlock.addEventListener('click', () => {
if (thought >= 20) {
thought -= 20
abilityDiv.style.display = 'inline-block'
thoughtAbilityUnlock.style.display = 'none'
abilityTriggerable = true
abilities[2].unlocked = true
}

})
acidUnlock.addEventListener('click', () => {
if (thought >= 5) {
thought -= 5
abilityDiv.style.display = 'inline-block'
acidUnlock.style.display = 'none'
abilityTriggerable = true
abilities[0].unlocked = true
}
})

// Increase will gain (cost in hope)
willGain.addEventListener('click', () => {
  if (hope >= willGainCost && dead == true && willGainLevel < 10){
    hope -= willGainCost;
    willMultiply += 1;
    willGainCost *= willGainScale;
	willGainLevel += 1
	if (willGainLevel == 10) {
    willGain.textContent = 'Maxed'
} else {
    willGain.textContent = `Increase will gain: ${willGainCost.toFixed(02)} Hope`;
}
    updateDisplays();
  }
});

// Increase starting blood permanently (cost in hope)
bloodGain.addEventListener('click', () => {
  if (hope >= bloodGainCost && dead == true && startingBloodLevel < 5) {
    hope -= bloodGainCost;
	startingBloodLevel += 1
    Startblood += 5;
    bloodGainCost *= bloodGainScale;
	if (startingBloodLevel == 5) {
	bloodGain.textContent = 'Maxed'
}
 else {
    bloodGain.textContent = `Increase starting blood: ${bloodGainCost.toFixed(02)} Hope`;
}
    updateDisplays();
  }
});
brainBtn.addEventListener('click', () => {
if (mutagen >= 1) {
mutagen -= 1
mutagenLabel.textContent = `Mutagen: ${mutagen}`
brainDiv.style.display = 'inline-block'
brainBtn.style.display = 'none'
}
})
exploreAuto.addEventListener('input',() => {
const rate = parseFloat(exploreAuto.value)
exploreAutomated = rate > 0
})
// Reveal will-based upgrades (cost in hope)
willUpgrade.addEventListener('click', () => {
  if (dead == true && hope >= 5){
    hope -= 5;
    willBlood.style.display = 'inline-block';
	hopeMult.style.display = 'inline-block'
	bloodproduce.style.display = 'inline-block'
    willUpgrade.style.display = 'none';
	
	willShow = true
    storyText.textContent = 'You can now spend Will during a run. (This will not affect hope gain)';
    updateDisplays();
  }
});

/* ---------- Initialization ---------- */
function initAbilities() {
  // link slider elements once DOM is ready
  for (const ability of abilities) {
    if (ability.sliderId) {
      ability.sliderElem = document.getElementById(ability.sliderId);
      if (ability.sliderElem) {
        ability.sliderElem.addEventListener("input", () => {
          ability.active = parseFloat(ability.sliderElem.value) > 0;
        });
      }
    }
  }
}
// optional per-panel onShow hooks
const onShow = {
  combat: () => {
    // refresh combat UI when user opens combat tab
    combatDiv.style.display = 'inline-block'; // if you still control visibility via this
    // force immediate UI update for monster stats
    monsterArr.forEach(m => {
      if (m.nameDisplay) m.nameDisplay.textContent = m.name;
      if (m.healthDisplay) m.healthDisplay.textContent = `${m.health}/${m.maxHealth}`;
      if (m.attackDisplay) m.attackDisplay.textContent = `${m.progress.toFixed(02)}/${m.cost.toFixed(02)}`;
    });
  },
  abilities: () => {
    // refresh ability displays if you want
    abilities.forEach(a => {
      if (a.progressDisplay) a.progressDisplay.textContent = `${a.progress.toFixed(02)}/${a.cost.toFixed(02)}`;
      if (a.autoDisplay && a.sliderElem) a.autoDisplay.textContent = `Blood automation: ${parseFloat(a.sliderElem.value).toFixed(02)}/s`;
    });
  }
};

function showTab(name) {
  // hide all panels
  Object.values(panelIds).forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });

  // remove active class from all tab buttons
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

  // show requested panel (and make any ancestor tab-panel visible)
  const panel = document.getElementById(panelIds[name]);
  if (panel) {
    panel.style.display = 'block';

    // ensure any ancestor tab-panel containers are also shown (fixes accidental nesting)
   
  }

  // mark button active
  const btn = document.querySelector(`.tab-btn[data-tab="${name}"]`);
  if (btn) btn.classList.add('active');

  // run optional refresh callback
  if (onShow[name]) onShow[name]();

  if (name === "combat") {
  updateCombatUI();
  combatShown = true;

  if (abilityTriggerable === true) {
    // show the ability container
    abilityDiv.style.display = 'inline-block';

    // show unlocked ability panels, hide locked ones
    for (const ability of abilities) {
      if (ability.abilityDiv) {
        ability.abilityDiv.style.display = ability.unlocked ? 'inline-block' : 'none';
      }
      // also show/hide any linked sliders
      if (ability.sliderElem) {
        ability.sliderElem.style.display = ability.unlocked ? '' : 'none';
      }
    }
  }

  if (combatEngaged == false) {
    combatDiv.style.display = 'none';
  }
} else {
  combatShown = false;
}
console.log(document.querySelectorAll('.tab-btn').forEach(b => console.log(b, b.dataset.tab)))
}




// wire tab buttons
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
console.log("Story tab clicked:", btn.dataset.tab);
showTab(btn.dataset.tab)});
});

// optionally show the default tab
showTab('main');



initAbilities()
// Make sure displays show initial values and the run is not active until user starts

setInterval(saveGame, 5000)
// loadGame()
updateDisplays();
// (optionally auto-start)
startRun();
</script>

</body>
</html>
